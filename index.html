<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Edu Daily</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#000;
  --btn:#2563eb;
}
.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#ffffff;
}
body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
}
header{
  display:flex;
  justify-content:space-between;
  padding:12px;
  font-weight:bold;
}
.site-title{
  font-size: 2.7em;
  font-weight: 900;
  letter-spacing: 1.4px;
  text-transform: uppercase;
  background: linear-gradient(90deg, #2563eb, #9333ea);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  }
  /* üîî Sliding ticker below Edu Daily */
.ticker {
  width: 100%;
  overflow: hidden;
  white-space: nowrap;
  margin-top: 4px;
}

.ticker-text {
  display: inline-block;
  padding-left: 100%;
  animation: tickerMove 15s linear infinite;
}

/* ‚è∏ Pause on hover (desktop) & touch (mobile) */
.ticker-text:hover {
  animation-play-state: paused;
}

.ticker:active .ticker-text {
  animation-play-state: paused;
}
  font-size: 0.95rem;
  font-weight: 600;
  color: #2563eb;
}

.dark .ticker-text {
  color: #93c5fd;
}

@keyframes tickerMove {
  from {
    transform: translateX(0%);
  }
  to {
    transform: translateX(-100%);
  }
}
button,input,textarea,select{
  width:100%;
  padding:8px;
  margin:6px 0;
}
button{
  background:var(--btn);
  color:#fff;
  border:none;
  border-radius:4px;
}
.post{
  background:var(--card);
  padding:10px;
  margin:10px;
  border-radius:6px;
}
.hidden{display:none}
.likeBtn{background:#ef4444}
.catBtn{margin:5px}
small{opacity:.7}
.adminBtn{background:#64748b;margin-top:5px}
.quoteBox{
  font-style:italic;
  border-left:4px solid #2563eb;
}
  .post-content{
  white-space: pre-line;
  }
</style>
</head>

<body>

<header>
  <div>
    <div class="site-title">Edu Daily</div>

    <!-- üîî Sliding ticker -->
    <div class="ticker">
      <div class="ticker-text" id="tickerText">
        Loading updates...
      </div>
    </div>
  </div>

  <div id="datetime"></div>
</header>

<button onclick="toggleDark()">üåô Dark Mode</button>

<div style="padding:10px">
  <button class="catBtn" onclick="loadCategory('Current Affairs')">Current Affairs</button>
  <button class="catBtn" onclick="loadCategory('Maths')">Maths</button>
  <button class="catBtn" onclick="loadCategory('General Awareness')">General Awareness</button>
</div>

<!-- üìå QUOTE (VISIBLE TO ALL) -->
<div id="quoteBox" class="post quoteBox hidden"></div>

<div id="contactBox" class="post hidden"></div>

<!-- üîê ADMIN LOGIN (ONLY VIA #admin) -->
<div id="loginBox" class="post hidden">
  <h3>Admin Login</h3>
  <input type="email" id="adminEmail" placeholder="Admin email">
  <input type="password" id="adminPass" placeholder="Admin password">
  <button onclick="login()">Login</button>
</div>

<!-- üëë ADMIN PANEL -->
<div id="adminPanel" class="post hidden">
  <h3 id="panelTitle">New Post</h3>

  <input id="postId" class="hidden">
  <input id="title" placeholder="Title">

  <select id="category">
    <option>Current Affairs</option>
    <option>Maths</option>
    <option>General Awareness</option>
  </select>

  <textarea id="content" placeholder="Write content"></textarea>
  <input id="link" placeholder="Optional link">

  <button onclick="publish()">Publish / Update</button>

  <hr>
  <hr>
<h4>üîî Ticker Message (max 30 words)</h4>
<textarea id="tickerInput" placeholder="Write ticker text (max 30 words)"></textarea>
<button onclick="saveTicker()">Save Ticker</button>

  <!-- ‚ú® QUOTE ADMIN -->
  <h4>Daily Quote (max 50 words)</h4>
  <textarea id="quoteInput" placeholder="Write short quote (max 50 words)"></textarea>
  <button onclick="saveQuote()">Save Quote</button>

  <hr>

  <h4>Contact Link</h4>
  <input id="contactInput" placeholder="Email / Telegram / Phone">
  <button onclick="saveContact()">Save Contact</button>

  <button onclick="logout()">Logout</button>
</div>

<div id="posts"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî• FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyDO-UrwPnC7CR2NCx9B0Dp60113hic0Pmk",
  authDomain: "edu-daily-a3450.firebaseapp.com",
  databaseURL: "https://edu-daily-a3450-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "edu-daily-a3450",
  storageBucket: "edu-daily-a3450.firebasestorage.app",
  messagingSenderId: "1001097804786",
  appId: "1:1001097804786:web:5a732b5de9e42f03d8896b"
};

firebase.initializeApp(firebaseConfig);

const auth = firebase.auth();
const db = firebase.database();

/* üïí DATE & TIME */
setInterval(()=>{
  datetime.innerText = new Date().toLocaleString();
},1000);

/* üåô DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
}

// üîê Admin UI control (DO NOT TOUCH quoteBox)
function handleAdminUI(user) {
  // Always hide admin panel first
  adminPanel.classList.add("hidden");
  loginBox.classList.add("hidden");

  // Only show login on #admin
  if (location.hash === "#admin") {
    if (user) {
      adminPanel.classList.remove("hidden");
    } else {
      loginBox.classList.remove("hidden");
    }
  }
}

auth.onAuthStateChanged(user => {
  handleAdminUI(user);
});

/* üîê AUTH */
function login(){
  auth.signInWithEmailAndPassword(
    adminEmail.value.trim(),
    adminPass.value.trim()
  ).catch(e=>alert(e.message));
}
function logout(){ auth.signOut(); }

/* üìå QUOTE (AUTO DELETE AFTER 24H) */
function saveQuote(){
  const text = quoteInput.value.trim();
  if(text.split(/\s+/).length > 50){
    alert("Maximum 50 words allowed");
    return;
  }
  db.ref("quote").set({
    text,
    time: Date.now()
  });
  quoteInput.value="";
}

db.ref("quote").on("value", s => {
  const q = s.val();

  if (!q || !q.text) {
    quoteBox.classList.add("hidden");
    return;
  }

  quoteBox.innerHTML = `üí¨ <b>Daily Quote:</b><br>${q.text}`;
  quoteBox.classList.remove("hidden");
});

/* üìû CONTACT */
function saveContact(){
  db.ref("contact").set(contactInput.value);
}
db.ref("contact").on("value",s=>{
  if(s.val()){
    contactBox.innerHTML=`üìû <a href="${s.val()}" target="_blank">${s.val()}</a>`;
    contactBox.classList.remove("hidden");
  }
});

/* üìù ADD / EDIT POST */
function publish(){
  const id = postId.value || Date.now();
  db.ref("posts/"+id).set({
    title:title.value,
    category:category.value,
    content:content.value,
    link:link.value,
    time:Date.now()
  });
  postId.value=title.value=content.value=link.value="";
  panelTitle.innerText="New Post";
}

/* üóë DELETE POST */
function deletePost(id){
  if(confirm("Delete this post?")){
    db.ref("posts/"+id).remove();
    db.ref("comments/"+id).remove();
    db.ref("likes/"+id).remove();
  }
}

/* ‚úè EDIT POST */
function editPost(id){
  db.ref("posts/"+id).once("value",s=>{
    const p=s.val();
    postId.value=id;
    title.value=p.title;
    category.value=p.category;
    content.value=p.content;
    link.value=p.link;
    panelTitle.innerText="Edit Post";
    scrollTo(0,0);
  });
}

  function saveTicker() {
  const text = tickerInput.value.trim();
  if (!text) return;

  if (text.split(" ").length > 30) {
    alert("Max 30 words allowed");
    return;
  }

  db.ref("ticker").set({
    text: text,
    time: Date.now()
  });

  tickerInput.value = "";
  }
  db.ref("ticker").on("value", s => {
  if (!s.val()) return;
  document.getElementById("tickerText").innerText = s.val().text;
});
  
/* üëç LIKE (1 PER DEVICE) */
function likePost(id){
  const key = "liked_" + id;

  if(localStorage.getItem(key)) {
    alert("You already liked this post");
    return;
  }

  db.ref("likes/" + id).transaction(v => (v || 0) + 1);
  localStorage.setItem(key, "yes");
}

/* üí¨ COMMENT (MAX 10 PER DEVICE) */
function addComment(id){
  const key = "commentCount_" + id;
  let used = Number(localStorage.getItem(key) || 0);

  if (used >= 10) {
    alert("Comment limit reached for this post");
    return;
  }

  const i = document.getElementById("c_" + id);
  if (!i.value.trim()) return;

  db.ref("comments/" + id + "/" + Date.now()).set({
    text: i.value.trim()
  });

  i.value = "";
  localStorage.setItem(key, used + 1);
}

/* üóë DELETE COMMENT (ADMIN) */
function deleteComment(pid,cid){
  db.ref("comments/"+pid+"/"+cid).remove();
}

/* üìÇ LOAD CATEGORY */
function loadCategory(cat){
  posts.innerHTML="";
  db.ref("posts").orderByChild("category").equalTo(cat).on("value",snap=>{
    snap.forEach(s=>{
      const p=s.val(),id=s.key;
      posts.innerHTML = `
      <div class="post">
        <h3>${p.title}</h3>
        <small>${new Date(p.time).toLocaleString()}</small>
        <div class="post-content">
  ${p.content.replace(/\n/g, "<br>")}
</div>
        ${p.link?`<a href="${p.link}" target="_blank">Link</a>`:""}
        <hr>
        <button class="likeBtn" onclick="likePost('${id}')">‚ù§Ô∏è Like</button>
        <span id="like_${id}">0</span>
        <hr>
        <input id="c_${id}" placeholder="Write comment">
        <button onclick="addComment('${id}')">Comment</button>
        <div id="com_${id}"></div>
        ${auth.currentUser?`
          <button class="adminBtn" onclick="editPost('${id}')">Edit</button>
          <button class="adminBtn" onclick="deletePost('${id}')">Delete</button>
        `:""}
      </div>` + posts.innerHTML;

      db.ref("likes/"+id).on("value",v=>{
        document.getElementById("like_"+id).innerText=v.val()||0;
      });

      db.ref("comments/"+id).on("value",c=>{
        let h="";
        c.forEach(x=>{
          h+=`<p>üí¨ ${x.val().text}
          ${auth.currentUser?`<button onclick="deleteComment('${id}','${x.key}')">‚ùå</button>`:""}
          </p>`;
        });
        document.getElementById("com_"+id).innerHTML=h;
      });
    });
  });
}
</script>

</body>
</html>

















