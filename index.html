<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Edu Daily</title>

<style>
:root{
  --bg:#f5f7fa;
  --card:#ffffff;
  --text:#000;
  --btn:#2563eb;
}
.dark{
  --bg:#0f172a;
  --card:#1e293b;
  --text:#fff;
}
body{
  margin:0;
  font-family:Arial;
  background:var(--bg);
  color:var(--text);
  padding:10px;
}
.post{
  background:var(--card);
  padding:10px;
  border-radius:6px;
  margin:10px 0;
}
button{
  width:100%;
  padding:8px;
  background:var(--btn);
  color:#fff;
  border:none;
  border-radius:4px;
  margin-top:6px;
}
.likeBtn{background:#ef4444}
.delBtn{background:#dc2626}
.editBtn{background:#16a34a}
input,textarea,select{
  width:100%;
  padding:8px;
  margin:6px 0;
}
.hidden{display:none}
.top{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.catBtn{
  background:#e5e7eb;
  color:#000;
}
.dark .catBtn{background:#334155;color:#fff}
.quoteBox{
  background:#fff8dc;
  padding:10px;
  border-radius:6px;
  margin:10px 0;
  font-style:italic;
}
.dark .quoteBox{background:#1e293b}
.contactBox{
  background:#e0f2fe;
  padding:10px;
  border-radius:6px;
  margin:10px 0;
}
.dark .contactBox{background:#1e293b}
small{opacity:.7}
</style>
</head>

<body>

<div class="top">
  <h2>Edu Daily</h2>
  <div id="dateTime"></div>
</div>

<button onclick="toggleDark()">üåô Dark Mode</button>

<!-- CONTACT -->
<div id="contactBox" class="contactBox" style="display:none"></div>

<!-- CATEGORY FILTER -->
<button class="catBtn" onclick="setCategory('Current Affairs')">Current Affairs</button>
<button class="catBtn" onclick="setCategory('Maths')">Maths</button>
<button class="catBtn" onclick="setCategory('General Awareness')">General Awareness</button>

<!-- QUOTE -->
<div id="quoteBox" class="quoteBox" style="display:none"></div>

<hr>

<!-- LOGIN -->
<div id="loginBox">
  <input type="email" id="adminEmail" placeholder="Admin email">
  <input type="password" id="adminPass" placeholder="Admin password">
  <button onclick="login()">Admin Login</button>
</div>

<!-- ADMIN PANEL -->
<div id="adminPanel" class="hidden">
  <button onclick="logout()">Logout</button>

  <h3>Contact</h3>
  <input id="contactInput" placeholder="tel: / mailto: / telegram link">
  <button onclick="saveContact()">Save Contact</button>

  <h3>Daily Quote (max 50 words)</h3>
  <textarea id="quoteInput"></textarea>
  <button onclick="saveQuote()">Save Quote</button>

  <h3 id="formTitle">New Post</h3>
  <input id="title" placeholder="Title">
  <select id="category">
    <option>Current Affairs</option>
    <option>Maths</option>
    <option>General Awareness</option>
  </select>
  <textarea id="content" placeholder="Content"></textarea>
  <input id="link" placeholder="Optional link">
  <input id="pdf" placeholder="PDF link">
  <input id="image" placeholder="Image URL">
  <button onclick="savePost()">Save Post</button>
</div>

<hr>
<div id="posts"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* üî• FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyDO-UrwPnC7CR2NCx9B0Dp60113hic0Pmk",
  authDomain: "edu-daily-a3450.firebaseapp.com",
  databaseURL: "https://edu-daily-a3450-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "edu-daily-a3450"
});

const db = firebase.database();
const auth = firebase.auth();

/* DATE + TIME */
setInterval(()=>{
  dateTime.innerText = new Date().toLocaleString();
},1000);

/* DARK MODE */
function toggleDark(){
  document.body.classList.toggle("dark");
}

/* AUTH */
auth.onAuthStateChanged(user=>{
  if(user){
    adminPanel.classList.remove("hidden");
    loginBox.style.display="none";
  }else{
    adminPanel.classList.add("hidden");
    loginBox.style.display="block";
  }
});
function login(){
  auth.signInWithEmailAndPassword(adminEmail.value,adminPass.value)
  .catch(()=>alert("Login failed"));
}
function logout(){ auth.signOut(); }

/* CONTACT */
function saveContact(){
  db.ref("contact").set(contactInput.value);
}
db.ref("contact").on("value",s=>{
  contactBox.style.display = s.val()?"block":"none";
  if(s.val())
    contactBox.innerHTML=`üìû <a href="${s.val()}" target="_blank">${s.val()}</a>`;
});

/* QUOTE */
function saveQuote(){
  if(quoteInput.value.split(" ").length>50){
    alert("Max 50 words"); return;
  }
  db.ref("quote").set({text:quoteInput.value,time:Date.now()});
  quoteInput.value="";
}
db.ref("quote").on("value",s=>{
  if(!s.exists()) return quoteBox.style.display="none";
  const q=s.val();
  if(Date.now()-q.time>86400000){
    db.ref("quote").remove();
    quoteBox.style.display="none";
  }else{
    quoteBox.innerText="‚Äú "+q.text+" ‚Äù";
    quoteBox.style.display="block";
  }
});

/* POSTS */
let currentCategory=null;
let editId=null;

function setCategory(c){ currentCategory=c; loadPosts(); }

function savePost(){
  const data={
    title:title.value,
    category:category.value,
    content:content.value,
    link:link.value,
    pdf:pdf.value,
    image:image.value,
    time:new Date().toLocaleString()
  };
  if(editId){
    db.ref("posts/"+editId).update(data);
    editId=null;
    formTitle.innerText="New Post";
  }else{
    db.ref("posts/"+Date.now()).set(data);
  }
  title.value=content.value=link.value=pdf.value=image.value="";
}

function loadPosts(){
  if(!currentCategory){ posts.innerHTML=""; return; }
  db.ref("posts").orderByChild("category").equalTo(currentCategory)
  .on("value",snap=>{
    posts.innerHTML="";
    snap.forEach(s=>renderPost(s.key,s.val()));
  });
}

function renderPost(id,p){
posts.innerHTML+=`
<div class="post">
<b>${p.title}</b><br>
<small>${p.category} ‚Ä¢ ${p.time}</small>
<p>${p.content}</p>

${p.image?`<img src="${p.image}" width="100%">`:""}
${p.link?`<a href="${p.link}" target="_blank">Link</a>`:""}
${p.pdf?`<a href="${p.pdf}" target="_blank">PDF</a>`:""}

<hr>

<button class="likeBtn" onclick="likePost('${id}')">‚ù§Ô∏è Like</button>
<span id="like_${id}">0</span>

<hr>

<input id="c_${id}" placeholder="Write comment">
<button onclick="addComment('${id}')">Comment</button>
<div id="comments_${id}"></div>

${auth.currentUser?`
<button class="editBtn" onclick="editPost('${id}')">Edit</button>
<button class="delBtn" onclick="deletePost('${id}')">Delete</button>
`:""}
</div>`;
loadLikes(id);
loadComments(id);
}

/* EDIT / DELETE */
function editPost(id){
  db.ref("posts/"+id).once("value",s=>{
    const p=s.val();
    title.value=p.title;
    category.value=p.category;
    content.value=p.content;
    link.value=p.link||"";
    pdf.value=p.pdf||"";
    image.value=p.image||"";
    editId=id;
    formTitle.innerText="Edit Post";
    window.scrollTo(0,0);
  });
}
function deletePost(id){
  if(confirm("Delete post?")) db.ref("posts/"+id).remove();
}

/* LIKE (1 per device) */
function likePost(id){
  if(localStorage.getItem("like_"+id)) return;
  db.ref("likes/"+id).transaction(v=>(v||0)+1);
  localStorage.setItem("like_"+id,"1");
}
function loadLikes(id){
  db.ref("likes/"+id).on("value",s=>{
    document.getElementById("like_"+id).innerText=s.val()||0;
  });
}

/* COMMENTS (MAX 10 PER DEVICE) */
function addComment(id){
  let used=Number(localStorage.getItem("cmt")||0);
  if(used>=10) return alert("Comment limit reached");
  const i=document.getElementById("c_"+id);
  if(!i.value.trim()) return;
  db.ref("comments/"+id+"/"+Date.now()).set({text:i.value});
  localStorage.setItem("cmt",used+1);
  i.value="";
}
function loadComments(id){
  db.ref("comments/"+id).on("value",s=>{
    let h="";
    s.forEach(c=>{
      h+=`<p>üí¨ ${c.val().text}
      ${auth.currentUser?`<button onclick="deleteComment('${id}','${c.key}')">‚ùå</button>`:""}
      </p>`;
    });
    document.getElementById("comments_"+id).innerHTML=h;
  });
}
function deleteComment(pid,cid){
  if(confirm("Delete comment?"))
    db.ref("comments/"+pid+"/"+cid).remove();
}
</script>

</body>
</html>